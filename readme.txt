=== Kashiwazaki SEO Custom 404 ===
Contributors: tsuyoshikashiwazaki
Tags: 404, error page, redirect, seo, custom 404
Requires at least: 5.0
Tested up to: 6.4
Requires PHP: 7.0
Stable tag: 1.0.2
License: GPLv2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html

HTTP 404エラー時にオリジナルのエラーページを表示し、リダイレクト候補や関連性の高い記事・最新記事を提示します。

== Description ==

HTTP 404エラー時にオリジナルのエラーページを表示し、リダイレクト候補や関連性の高い記事・最新記事を提示するWordPressプラグインです。

= 特徴 =

* **SEOフレンドリー**: 適切なHTTPステータスコード(404/410)とCanonicalヘッダーで検索エンジンに正しい情報を伝達
* **自動リダイレクト候補検出**: URLのスラッグから移動先ページを自動検出
* **関連記事表示**: タグベースで関連性の高い記事を提示し、ユーザーの離脱を防止
* **構造化データ対応**: Schema.org準拠のJSON-LDマークアップを自動出力
* **5種類の配色テーマ**: サイトのデザインに合わせて選択可能

= 表示設定 =

* **最新記事の表示件数**: 404ページに表示する最新記事数（0で非表示）
* **関連性の高い記事の表示件数**: タグベースの関連記事数（0で非表示）
* **表示する投稿タイプ**: 記事取得対象の投稿タイプ
* **配色テーマ**: 5種類から選択（Default Blue, Midnight Calm, Crisp Contrast, Forest Bath, Sunset Glow）

= リダイレクト・HTTPステータス設定 =

**移動先ページが検知できた場合:**

* テーマのデフォルト404ページを表示
* カスタム404ページ + Canonicalヘッダー（推奨）
* カスタム410ページ + Canonicalヘッダー
* カスタム200ページ + Canonicalヘッダー
* 301リダイレクト（恒久的）
* 302リダイレクト（一時的）

**移動先ページが見つからない場合:**

* テーマのデフォルト404ページを表示
* カスタム404ページを表示（推奨）
* カスタム410ページを表示
* カスタム200ページを表示
* 指定URLへ301リダイレクト
* 指定URLへ302リダイレクト

= 動作の仕組み =

1. 404エラー発生時にWordPressのフックで検知
2. リクエストURLのスラッグで既存記事を検索
3. 移動先が見つかれば「検知時」の設定、見つからなければ「見つからない時」の設定を適用
4. カスタムページ表示時は関連記事・最新記事・検索フォームを含むページを出力

= SEO効果 =

* **Canonicalヘッダー**: 移動先URLをCanonicalで示し、検索エンジンに正しいURLを伝達
* **構造化データ**: WebPage/BreadcrumbListのJSON-LDを出力
* **適切なステータスコード**: 404/410を正しく返すことでインデックス管理を最適化

== Installation ==

1. このプラグインをダウンロード
2. WordPressの`wp-content/plugins/`ディレクトリにアップロード
3. 管理画面の「プラグイン」メニューからプラグインを有効化
4. 管理画面左メニュー「Kashiwazaki SEO Custom 404」で設定を調整

== Frequently Asked Questions ==

= プラグインを有効化したら何もしなくていいですか？ =

はい。デフォルト設定でも動作しますが、管理画面で配色テーマや表示件数などをカスタマイズできます。

= 404ページの見た目を変更したい =

管理画面 → Kashiwazaki SEO Custom 404 で配色テーマを選択できます。5種類のプリセットテーマから選べます。

= 既存の404.phpテンプレートと競合しますか？ =

設定で「テーマのデフォルト404を表示」を選択すれば、テーマの404.phpが使用されます。カスタムページ表示を選択した場合は、このプラグインのページが表示されます。

== Changelog ==

= 1.0.2 =
* 修正: URLからの投稿タイプ検出を追加し、CPT間の誤マッチを防止
* 修正: キーワード検索の最低一致率ゲート（50%以上）を追加し、単一キーワードの誤検出を防止
* 修正: 最低スコア閾値を40から45に引き上げ
* 修正: キーワード最低文字数を2文字から3文字に引き上げ（mb_strlen対応）

= 1.0.1 =
* 追加: 投稿タイプ選択に「すべての投稿タイプを対象にする」オプションを追加
* 強化: 移動先ページ検出機能（類似スラッグ検索、タイトルキーワード検索）
* 改善: 個別の投稿タイプ選択をアコーディオン形式に変更

= 1.0.0 =
* 初回リリース

== Upgrade Notice ==

= 1.0.2 =
リダイレクト精度を改善。投稿タイプ検出とキーワード一致率ゲートにより誤マッチを大幅に削減します。

= 1.0.1 =
移動先ページ検出機能を強化。類似スラッグやタイトルからも候補を検出します。
