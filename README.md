# Kashiwazaki SEO Custom 404

![WordPress](https://img.shields.io/badge/WordPress-5.0%2B-blue.svg)
![PHP](https://img.shields.io/badge/PHP-7.0%2B-blue.svg)
![License](https://img.shields.io/badge/license-GPL--2.0%2B-green.svg)
![Version](https://img.shields.io/badge/version-1.0.2-blue.svg)

HTTP 404エラー時にオリジナルのエラーページを表示し、リダイレクト候補や関連性の高い記事・最新記事を提示するWordPressプラグインです。

## 特徴

- **SEOフレンドリー**: 適切なHTTPステータスコード(404/410)とCanonicalヘッダーで検索エンジンに正しい情報を伝達
- **自動リダイレクト候補検出**: URLのスラッグから移動先ページを自動検出
- **関連記事表示**: タグベースで関連性の高い記事を提示し、ユーザーの離脱を防止
- **構造化データ対応**: Schema.org準拠のJSON-LDマークアップを自動出力
- **5種類の配色テーマ**: サイトのデザインに合わせて選択可能

## インストール

1. このプラグインをダウンロード
2. WordPressの`wp-content/plugins/`ディレクトリにアップロード
3. 管理画面の「プラグイン」メニューからプラグインを有効化
4. 管理画面左メニュー「Kashiwazaki SEO Custom 404」で設定

## 使い方

### 基本設定

プラグインを有効化すると、404エラー発生時に自動でカスタムページが表示されます。

管理画面 → **Kashiwazaki SEO Custom 404** で以下の設定が可能です。

### 表示設定

| 設定項目 | 説明 | デフォルト |
|---------|------|-----------|
| **最新記事の表示件数** | 404ページに表示する最新記事数。0で非表示 | 5件 |
| **関連性の高い記事の表示件数** | タグベースの関連記事数。0で非表示 | 3件 |
| **表示する投稿タイプ** | 記事取得対象の投稿タイプ | すべて |
| **配色テーマ** | ページの配色 | Default Blue |

### 配色テーマ

| テーマ名 | 説明 |
|---------|------|
| **Default Blue** | 白背景にWordPress標準の青。標準的で見やすい |
| **Midnight Calm** | ダークモード。黒背景に明るいテキスト |
| **Crisp Contrast** | ハイコントラスト。視認性重視 |
| **Forest Bath** | ナチュラル系。緑基調で目に優しい |
| **Sunset Glow** | 柑橘系。オレンジ基調で暖かみのある配色 |

### リダイレクト・HTTPステータス設定

#### 移動先ページが検知できた場合

URLのスラッグから既存ページが特定できた場合の動作を選択します。

| 選択肢 | 説明 |
|-------|------|
| テーマのデフォルト404 | プラグインを無効化した状態と同じ |
| **カスタム404 + Canonical (推奨)** | 404ステータスでカスタムページ表示。Canonicalヘッダーで移動先を示唆 |
| カスタム410 + Canonical | 410(Gone)ステータス。コンテンツが完全に削除された場合向け |
| カスタム200 + Canonical | 200ステータス。ソフト404になる可能性あり |
| 301リダイレクト | 移動先へ恒久的リダイレクト |
| 302リダイレクト | 移動先へ一時的リダイレクト |

#### 移動先ページが見つからない場合

スラッグから移動先が特定できなかった場合の動作を選択します。

| 選択肢 | 説明 |
|-------|------|
| テーマのデフォルト404 | プラグインを無効化した状態と同じ |
| **カスタム404 (推奨)** | 404ステータスでカスタムページ表示 |
| カスタム410 | 410(Gone)ステータス |
| カスタム200 | 200ステータス（非推奨：ソフト404） |
| 指定URLへ301リダイレクト | 指定したURLへ恒久的リダイレクト |
| 指定URLへ302リダイレクト | 指定したURLへ一時的リダイレクト |

### 動作の仕組み

1. **404エラー発生時**: WordPressが404と判定したアクセスをフック
2. **移動先検出**: リクエストURLのスラッグで既存記事を検索
3. **設定に基づく処理**:
   - 移動先が見つかった → 「移動先検知時」の設定を適用
   - 移動先が見つからない → 「見つからない時」の設定を適用
4. **カスタムページ表示**: 関連記事・最新記事・検索フォームを含むページを出力

### SEO効果

- **Canonicalヘッダー**: 移動先URLをCanonicalで示すことで、検索エンジンに正しいURLを伝達
- **構造化データ**: WebPage/BreadcrumbListのJSON-LDを出力
- **適切なステータスコード**: 404/410を正しく返すことでインデックス管理を最適化

## 要件

- WordPress 5.0以上
- PHP 7.0以上

## ライセンス

GPL-2.0 or later

## 著者

柏崎 剛 (Tsuyoshi Kashiwazaki)
- Website: https://www.tsuyoshikashiwazaki.jp
